<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guess the Song</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='50%25' x='50%25' dominant-baseline='middle' text-anchor='middle' font-size='48'%3E%F0%9F%8E%B5%3C/text%3E%3C/svg%3E">

  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }

    #app {
      width: 100%;
      max-width: 380px;
      padding: 2rem 1.5rem;
      border-radius: 24px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(16px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.2rem;
    }

    .title {
      font-size: 1.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    #cover {
      width: 220px;
      height: 220px;
      object-fit: cover;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
      display: none;
      transition: transform 0.3s ease;
    }

    #cover.show {
      display: block;
    }

    #info {
      min-height: 1.4em;
      font-weight: 500;
      text-align: center;
      opacity: 0.9;
    }

    #controls {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
    }

    #playlistSelection {
      width: 100%;
    }

    #playlistSelection div {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.4rem 0;
      font-size: 0.95rem;
    }

    button.general {
      width: 100%;
      border: none;
      padding: 0.75rem;
      border-radius: 14px;
      font-size: 1rem;
      font-weight: 500;
      background: linear-gradient(135deg, #8e2de2, #4a00e0);
      color: white;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button.general.secondary {
      background: rgba(255,255,255,0.15);
    }

    button.general:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }

    button.general:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #mainControls {
      width: 100%;
      display: none;
      gap: 0.6rem;
    }

    #hintBtn {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #ffeb3b, #ffc107);
      color: #000;
      font-size: 1.6rem;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
    }

    #hintBtn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="title">ðŸŽµ Name That Jam ðŸŽµ</div>

    <audio id="audio" preload="auto"></audio>

    <img id="cover" alt="Album Cover" />

    <div id="info">Select playlists and start the quiz.</div>

    <div id="controls">
      <div id="playlistSelection"></div>

      <button id="startBtn" class="general">Start Quiz</button>

      <div id="mainControls">
        <button id="playBtn" class="general" disabled>â–¶ Play 1s</button>
        <button id="revealBtn" class="general" disabled>Reveal</button>
        <button id="nextBtn" class="general" disabled>Next</button>
        <button id="backBtn" class="general secondary">Back</button>
      </div>

      <button id="hintBtn" disabled title="Hint (2s)">ðŸ’¡</button>
    </div>
  </div>

<script>
const playlists = [
  { id: '13382780523', name: 'Songs For Everybody 1940â€“2020s' },
  { id: '10431212082', name: 'Suomi IskelmÃ¤' },
  { id: '8346956262', name: 'Rock Classics 70sâ€“90s' },
  { id: '7206711884', name: 'James Bond Classics' },
  { id: '14237766141', name: 'Movies and Series' }
];

const deezerBase = 'https://api.deezer.com/playlist/';

let allTracks = [];
let pool = [];
let currentTrack = null;

const audio = document.getElementById('audio');
const playlistSelection = document.getElementById('playlistSelection');
const startBtn = document.getElementById('startBtn');
const mainControls = document.getElementById('mainControls');
const playBtn = document.getElementById('playBtn');
const hintBtn = document.getElementById('hintBtn');
const revealBtn = document.getElementById('revealBtn');
const nextBtn = document.getElementById('nextBtn');
const backBtn = document.getElementById('backBtn');
const infoDiv = document.getElementById('info');
const coverImg = document.getElementById('cover');

function renderPlaylists() {
  playlists.forEach(p => {
    const div = document.createElement('div');
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = true;
    cb.value = p.id;
    const label = document.createElement('label');
    label.textContent = p.name;
    div.appendChild(cb);
    div.appendChild(label);
    playlistSelection.appendChild(div);
  });
}

function loadPlaylistById(id) {
  return new Promise((resolve, reject) => {
    const cbName = 'jsonp_' + Math.random().toString(36).slice(2);
    window[cbName] = data => {
      delete window[cbName];
      script.remove();
      if (data.error) reject(data.error);
      else resolve(data.data);
    };
    const script = document.createElement('script');
    script.src = `${deezerBase}${id}/tracks?output=jsonp&callback=${cbName}`;
    document.body.appendChild(script);
  });
}

function resetToMenu() {
  mainControls.style.display = 'none';
  hintBtn.style.display = 'none';
  coverImg.classList.remove('show');

  playlistSelection.style.display = 'block';
  startBtn.style.display = 'block';

  audio.pause();
  infoDiv.textContent = 'Select playlists and start the quiz.';
}

startBtn.onclick = async () => {
  const selected = [...playlistSelection.querySelectorAll('input:checked')].map(i => i.value);
  if (!selected.length) return infoDiv.textContent = 'Select at least one playlist.';

  playlistSelection.style.display = 'none';
  startBtn.style.display = 'none';
  infoDiv.textContent = 'Loading tracks...';

  const lists = await Promise.all(selected.map(loadPlaylistById));
  allTracks = lists.flat().filter(t => t.preview);
  pool = [...allTracks];

  mainControls.style.display = 'block';
  hintBtn.style.display = 'flex';
  prepareRound();
};

backBtn.onclick = resetToMenu;

function prepareRound() {
  if (!pool.length) pool = [...allTracks];
  currentTrack = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];

  playBtn.disabled = false;
  hintBtn.disabled = false;
  revealBtn.disabled = true;
  nextBtn.disabled = true;

  coverImg.classList.remove('show');
  infoDiv.textContent = 'Play the preview and guess!';
}

function playSnippet(ms) {
  audio.src = currentTrack.preview;
  audio.play();
  setTimeout(() => audio.pause(), ms);
  revealBtn.disabled = false;
}

playBtn.onclick = () => playSnippet(1000);
hintBtn.onclick = () => playSnippet(2000);

revealBtn.onclick = () => {
  infoDiv.textContent = `${currentTrack.title_short} â€” ${currentTrack.artist.name}`;
  coverImg.src = currentTrack.album.cover_medium;
  coverImg.classList.add('show');
  nextBtn.disabled = false;
  playBtn.disabled = true;
  hintBtn.disabled = true;
};

nextBtn.onclick = prepareRound;

renderPlaylists();
</script>
</body>
</html>
